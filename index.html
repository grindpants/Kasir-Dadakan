<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style/style.css">
    <title>Document</title>
</head>
<body>
    <nav>
        <div class="menu2">
            <h1>menu2</h1>
        </div>
    </nav>
    <main>
        <div class="listItem">
                <fieldset>
                    <p>
                        <select name="" id="barang" required>
                            <option value="">----pilih barang-----</option>
                            <option value="30000">Nescafe</option>
                            <option value="15000">Sariroti</option>
                            <option value="8000">Gulaku</option>
                            <option value="5000">Oreo</option>
                            <option value="2500">Indomie</option>
                        </select>
        
                        <input type="text" id="x" readonly>
                        <label for="jumlah">Jumlah :</label>
                        <input type="number" id="jumlah" min="1" max="10" required>
        
                        <button type="button" name="add" id="add" >Tambah</button>
                        <button type="button" name="delete" id="delete" >Hapus</button>
                    </p>
                    <p>
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <td>Nama Barang</td>
                                    <td>Harga</td>
                                    <td>Jumlah</td>
                                    <td>Total</td>
                                </tr>
                            </thead>
                            <tbody style="height: 50%;" id="daftarPesanan">
                            </tbody>
                        </table>
                    </p>
                    <p>
                        <label for="totalSementara">Grand Total :</label>
                        <input id="totalSementara" type="text" readonly>
                        <label for="diskon">Diskon:</label>
                        <input id="diskon" type="number" >
                        <label for="sisa">Total Keseluruhan :</label>
                        <input id="sisa" type="number" readonly>
                        <button type="button" name="jumlah" id="jumlahKeseluruhan">Jumlah</button>
                    </p>
                </fieldset>
        </div>    
    </main>
    <footer>
            <div class="copyRight">
                <h1>copyright</h1>
            </div>
     </footer>
    
    <script>
        var pilih = document.getElementById("barang");
        var tambah = document.getElementById("add");
        var hapus = document.getElementById("delete");
        var total = document.getElementById("jumlahKeseluruhan");
        
        document.getElementById("jumlah").value = "";

        


        pilih.addEventListener('click', function(){
            
            var nilai = document.getElementById("barang").value;
            var jumlah = document.getElementById("jumlah").value;
            var x = document.getElementById("x");
            x.value = nilai;
           
           
        });
        
        tambah.addEventListener('click', function(){
            var daftarPesanan = document.getElementById("daftarPesanan"); //parent
            var namaBarang = document.querySelectorAll("#barang option");
            var nilai = document.getElementById("barang").value;
            var jumlah = document.getElementById("jumlah").value;
            var harga = document.getElementById("x").value;
            var totalKeseluruhan = document.getElementById("totalSementara");
            

            

            var NewRow = daftarPesanan.insertRow(-1); 
            var Newcell1 = NewRow.insertCell(0); 
            var Newcell2 = NewRow.insertCell(1);
            var Newcell3 = NewRow.insertCell(2);
            var Newcell4 = NewRow.insertCell(3);
            

            
            for(let i = 0; i < namaBarang.length; i++){
                if(nilai === namaBarang[i].value){
                    // insert new row. 
                    Newcell1.innerHTML = namaBarang[i].innerHTML;
                    Newcell2.innerHTML = nilai;
                    Newcell3.innerHTML = jumlah;
                    Newcell4.innerHTML = harga*jumlah;
                    Newcell4.value = harga*jumlah;
                }
                
            } 
            calculateTotal()
            
        });
        
        hapus.addEventListener('click', function() { 
            var totalKeseluruhan = document.getElementById("totalSementara");
            // delete row (index-0).             
            /* var nilai = totalKeseluruhan.value;

                    nilai -= Number(daftarPesanan.children[i].children[3].innerText)
                    totalKeseluruhan.value = nilai; */
                    
            
            document.getElementById("daftarPesanan").deleteRow(-1); 
            calculateTotal()

        }); 
       
        var calculateTotal = () => {
            var daftarPesanan = document.getElementById("daftarPesanan");
            var totalKeseluruhan = document.getElementById("totalSementara");
            var nilai = 0;
            for (var i = 0; i < daftarPesanan.children.length; i++){
                nilai += Number(daftarPesanan.children[i].children[3].innerText)
            }
            totalKeseluruhan.value = nilai;
        }
      

        total.addEventListener('click', function(){
            console.log('asd')
            var total = document.getElementById("totalSementara");
            var nilaiDiskon = document.getElementById("diskon");
            var totalKeseluruhan = document.getElementById("sisa");
            if (nilaiDiskon.value == 0) {
                totalKeseluruhan.value = Number(total.value)
            } else {
                totalKeseluruhan.value = (Number(total.value) * nilaiDiskon.value) / 100;
            }

            

        });
    </script>
</body>
</html>